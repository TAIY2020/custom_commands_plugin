# CustomCommands 插件

**一个允许你通过聊天命令动态添加、删除、列出和触发自定义回复的强大插件。**

这个插件赋予了麦麦一个“可编程”的记忆。管理员可以在聊天中随时“教”麦麦新的命令和回复，而无需重启或修改任何代码。所有添加的命令都会被永久保存。

## ✨ 功能特性

- **动态管理**: 无需重启，通过聊天命令即可实时添加、删除和查看自定义命令。
- **权限控制**: 仅限指定管理员可以添加或删除命令，确保安全可控。
- **多格式支持**: 回复内容可以是纯文本，也可以是图片。
- **自包含资源**: 图片等资源默认存放于插件自己的目录中，方便管理和分发。
- **持久化存储**: 所有自定义命令都会自动保存到插件目录下的 `custom_commands.json` 文件中，麦麦重启后依然有效。
- **高度可配置**: 命令的前缀和管理员列表均可在配置文件中轻松修改。

---

## 🚀 快速开始

### 1. 安装

下载 `custom_commands_plugin` 文件夹放入麦麦主程序的 `plugins` 目录下，然后重启主程序即可完成插件的注册和加载。

### 2. 配置

首次启动麦麦后，插件会在其目录下自动生成 `config.toml` (配置文件) 和 `custom_commands.json` (数据文件)。前者是关于插件的一些基础配置，后者是插件自定义命令的存储文件。同时，也会根据配置自动创建存放图片的目录。

**默认配置示例**:

```toml
# 插件基本信息
[plugin]

# 插件名称
name = "custom_commands_plugin"

# 插件版本
version = "1.5.2"

# 是否启用插件
enabled = true


# 命令基本设置
[settings]

# 所有自定义命令的前缀
command_prefix = "."

# 拥有添加/删除命令权限的用户ID列表 (QQ号)。留空 [] 表示任何人都没有权限。
admin_user_ids = []

# 存放自定义回复图片的目录路径（相对于主程序根目录）
image_directory = "plugins/custom_commands_plugin/images"
```

**⚠️ 重要安全提示**:

- **`command_prefix`**: 定义了所有命令的触发前缀，默认为 `.`。
- **`admin_user_ids`**: 这是一个**核心安全设置**。
  - 默认值为一个**空列表 `[]`**，这意味着**默认情况下，任何人都没有权限**添加或删除命令。
  - **您必须手动编辑此文件**，将管理员的 QQ 号添加到这个列表中，才能使用管理员命令。
  - **`image_directory`**: 指定了存放回复图片的文件夹路径，相对于主程序根目录。默认路径 `plugins/custom_commands_plugin/images` 会被自动创建。您可以将图片放入此文件夹，然后通过文件名来调用。

---

## 📖 使用指南

假设你的命令前缀 `command_prefix` 设置为 `.`。

### 👨‍💼 管理员命令 (需要配置权限)

#### 添加命令

使用 `.问：...答：...` 的格式来教麦麦新的回复。

- **格式**: `.问：<触发词>答：<回复内容>`
- **示例 (文本回复)**:

  ```text
  .问：你好答：你好啊！很高兴见到你！😊
  ```

- **示例 (图片回复)**:
  将图片（例如 `hello.png`）放入您在配置文件中指定的 `image_directory` 目录（默认为该插件目录下的 `images` 文件夹），然后使用文件名作为回复内容。

  ```text
  .问：打个招呼答：hello.png
  ```

#### 删除命令

使用 `.删：...` 的格式来让麦麦忘记一个命令。

- **格式**: `.删：<触发词>`
- **示例**:

  ```text
  .删：你好
  ```

### 🙋‍♀️ 通用命令 (任何人可用)

#### 列出所有命令

查看当前所有可用的自定义命令。为了避免自定义命令过多刷屏，麦麦会以一个**合并转发消息卡片**来展示列表。

- **格式**: `.列表`
- **麦麦回复**:
(一个包含所有命令的合并转发消息)

> **📋 可用的自定义命令列表：**
>
> ▪️ .你好
>
> ▪️ .打个招呼
>
> ▪️ .另一个命令

#### 触发命令

使用 `前缀` + `触发词` 来获取回复。

- **格式**: `<前缀><触发词>`
- **示例**:

  ```text
  .你好
  ```

- **麦麦回复**:

  ```text
  你好啊！很高兴见到你！😊
  ```

#### 命令示例

>![命令示例](./示例.jpg)

---

## 📝 注意事项

- **命令优先级**: `添加`、`删除`、`列表` 这三个管理命令的优先级高于您自定义的触发命令。例如，即使你创建了一个名为“列表”的自定义命令，输入 `.列表` 时，也总是会触发“列出所有命令”的功能。
- **图片路径**: 调用回复图片内容时需确保图片放在 `images` 文件夹内（默认为 `plugins/custom_commands_plugin/images`）。
- **数据文件**: 请勿手动编辑 `custom_commands.json` 文件，除非你完全清楚其结构和后果。错误的操作可能导致插件无法读取数据。

Enjoy! 🎉
